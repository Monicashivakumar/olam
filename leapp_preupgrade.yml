---
- name: Leapp Preupgrade stage
  hosts: all
  become: yes
  vars_files:
    - vars/defaults.yml
    - vars/vars.yml
    
- name: Cleanup previous preupgrade reports
  file:
    path: '{{ item }}'
    state: absent
  loop:
    - /var/log/leapp/leapp-report.txt
    - /var/log/leapp/leapp-report.json
  when:
    - 'not leapp_skip_preupgrade_cleanup | bool'

- name: Run leapp pre upgrade
  hosts: all
  become: yes
  become_method: sudo
  vars:
    leapp_switch: "{{ leapp_switch | default('--oraclelinux') }}"

  tasks:
    - name: Run leapp pre upgrade
      command: leapp preupgrade {{ leapp_switch }}
      
